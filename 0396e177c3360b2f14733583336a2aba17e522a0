{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "a3030683_60e3b577",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000298
      },
      "writtenOn": "2023-09-19T16:58:23Z",
      "side": 1,
      "message": "The xlat library should not be in charge of managing any context, as it is only a server that provides memory mapping services to its clients. It is responsibility of its clients to create and manage the translation contexts (and its mappings) via the API.\n\nTherefore, the library cannot handle the high region mappings. This should be done by a different component outside the library (could be done on a separate library or at the platform level, as it is done for the low level region for instance). Otherwise we are introducing coupling and dependencies (for instance, the xlat library needs to know about the slot buffer regions)",
      "revId": "0396e177c3360b2f14733583336a2aba17e522a0",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8f879106_b665ad53",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2023-09-20T17:07:04Z",
      "side": 1,
      "message": "Hi Javier\nyes what you say is correct. The lower VA is platform specific and hence xlat lib does not handle this on its own. But, the high VA is generic and we can create a generic high VA space. \n\nNot the trouble is that high VA space is shared between 2 entites now (and maybe more in future) xlat_ctx cannot be shared between the 2.\n\nWe could create a separate lib for high VA but it would be creating another lib which is dependant of xlat lib and this is not different from integrating directly into xlat lib.\n\nSo this is why I suggested this solution.\n\nThe high va manager \"knows\" the different needs of high VA use in RMM (all of them are generic). The 2 needs now are per-CPU stack and slot buffer . I think for now it is better for this to be part of xlat lib (albeit a separate file called \"high_va\"). It is too much trouble designing a suitable name and API for this component when it is very much related to xlat lib.",
      "parentUuid": "a3030683_60e3b577",
      "revId": "0396e177c3360b2f14733583336a2aba17e522a0",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ae63fe53_315fe947",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000298
      },
      "writtenOn": "2023-09-20T17:42:47Z",
      "side": 1,
      "message": "Yes, I agree that now that the high region is shared across several entities its management is trickier, which is why I suggested to create an entity to centralize its management (for instance, a library, as you mentioned). I know that this might add some hassle, which is the reason why I also suggested some other alternatives, such as plat_common_init.c, where the low region context is also handled. In my opinion it would be less problematic to have that component know about the high region mappings (or even query the slot buffer library, for instance, if necessary) and handle the high region context there rather than delegate that to the xlat library. It feels to me that the library is also its own client which I am not very happy with. Also, if in the future a different platform has different needs (such as different stack size) or some platform needs to add a different memory mapping to the high region, having that hardcoded in the xlat library I think could lead to integration problems in the future.",
      "parentUuid": "8f879106_b665ad53",
      "revId": "0396e177c3360b2f14733583336a2aba17e522a0",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "50da6610_3692fba8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 1000056
      },
      "writtenOn": "2023-09-21T13:51:36Z",
      "side": 1,
      "message": "Actually the client is still the slot buffer (as it makes use of xlat lib APIs to do the work). The working model is only changed for the creation of tables and rest of table manipulation is via xlat lib APIs.\n\nPreviously the specifying the xlat_ctx creation was left to the client. Now this has moved into the xlat table lib but with a difference that the slot buffer client can specify the number of slots to create.\n\nThe overhead for creating a new component is not fully justified IMO. The new component will essentially be a wrapper for just creating the high VA context but still rely on the clients to directly interact with xlat lib for getting high VA operations.  This would not be a typical component from that PoV.\n\n\nSo the high va component in xlat high va defines the types of clients it can service and currently there are 2 (slot buffer and stack). There will be config options to control the VA allocations for these 2 clients va 2 config options.\n\nSo platforms will not have trouble changing the stack size from that PoV.\n\nIf there are more clients in future, the high va will define suitable options to control their allocations and those clients will interact with xlat lib for operating on the high va.",
      "parentUuid": "ae63fe53_315fe947",
      "revId": "0396e177c3360b2f14733583336a2aba17e522a0",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e85fbe2b_27228453",
        "filename": "docs/getting_started/build-options.rst",
        "patchSetId": 2
      },
      "lineNbr": 218,
      "author": {
        "id": 1000298
      },
      "writtenOn": "2023-09-19T16:58:23Z",
      "side": 1,
      "message": "This is not (or it shouldn\u0027t be) a build option for the xlat library. Instead, it is a system parameter.",
      "range": {
        "startLine": 218,
        "startChar": 3,
        "endLine": 218,
        "endChar": 27
      },
      "revId": "0396e177c3360b2f14733583336a2aba17e522a0",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "12a938db_3e84121f",
        "filename": "lib/xlat/CMakeLists.txt",
        "patchSetId": 2
      },
      "lineNbr": 46,
      "author": {
        "id": 1000298
      },
      "writtenOn": "2023-09-19T16:58:23Z",
      "side": 1,
      "message": "See my previous comments about this. This is a system build option, not an xlat one. the xlat library shouldn\u0027t know anything abut any memory mapping/areas nor should handle any translation contexts. That should be done only by the library clients.",
      "range": {
        "startLine": 46,
        "startChar": 9,
        "endLine": 46,
        "endChar": 33
      },
      "revId": "0396e177c3360b2f14733583336a2aba17e522a0",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7af27d9d_ac40d898",
        "filename": "lib/xlat/include/xlat_high_va.h",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1000298
      },
      "writtenOn": "2023-09-19T16:58:23Z",
      "side": 1,
      "message": "I don\u0027t think this should be here at all. The xlat library should be generic and know nothing about the memory mappings or memory regions. The clients for the xlat library are the ones who should decide the mappings and use the library to create those.\n\nOtherwise, we are introducing coupling and dependencies on the library.\n\nThat was the reason why, originally, the mapping for the high region was all handled by the slot buffer mechanism (the slot buffer library was this library\u0027s client) or why the low region mappings are all handled by the plat_common_init.c (which is the client for the low region part).\n\nSince now the high region is used not only for the slot buffers but for the heaps, we need to look a common place where to handle those mappings (maybe plat_warmboot_setup() if the suggestions that I gave in previous comments are not ok?), but it should not be allocated here.",
      "revId": "0396e177c3360b2f14733583336a2aba17e522a0",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a3887290_ca78d2ae",
        "filename": "lib/xlat/src/aarch64/xlat_helper.S",
        "patchSetId": 2
      },
      "lineNbr": 6,
      "author": {
        "id": 1000298
      },
      "writtenOn": "2023-09-19T16:58:23Z",
      "side": 1,
      "message": "The functionality of this file is not part of the xlat library. The xlat library should know nothing about the stacks (or any other memory regions/mappings)",
      "revId": "0396e177c3360b2f14733583336a2aba17e522a0",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "7aa2ae33_eb9f07a3",
        "filename": "lib/xlat/src/fake_host/xlat_helpers.c",
        "patchSetId": 2
      },
      "lineNbr": 8,
      "author": {
        "id": 1000298
      },
      "writtenOn": "2023-09-19T16:58:23Z",
      "side": 1,
      "message": "See my previous comment on this. The xlat library only handles memory mappings. The stack management doesn\u0027t fall on its responsibilities.",
      "range": {
        "startLine": 8,
        "startChar": 10,
        "endLine": 8,
        "endChar": 26
      },
      "revId": "0396e177c3360b2f14733583336a2aba17e522a0",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d2677322_fcb21bd8",
        "filename": "lib/xlat/src/xlat_high_va.c",
        "patchSetId": 2
      },
      "lineNbr": 1,
      "author": {
        "id": 1000298
      },
      "writtenOn": "2023-09-19T16:58:23Z",
      "side": 1,
      "message": "See my previous comments with regard this. This functionality is not responsibility of the xlat library.",
      "revId": "0396e177c3360b2f14733583336a2aba17e522a0",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6c7fbcd6_33f88d45",
        "filename": "runtime/CMakeLists.txt",
        "patchSetId": 2
      },
      "lineNbr": 97,
      "author": {
        "id": 1000298
      },
      "writtenOn": "2023-09-19T16:58:23Z",
      "side": 1,
      "message": "See my previous comment about this. The number of pages per stack should be a system build option, not a xlat one",
      "range": {
        "startLine": 97,
        "startChar": 38,
        "endLine": 97,
        "endChar": 62
      },
      "revId": "0396e177c3360b2f14733583336a2aba17e522a0",
      "serverId": "8f6f209b-db1a-4cbf-aa44-c8bc30e9bfda"
    }
  ]
}