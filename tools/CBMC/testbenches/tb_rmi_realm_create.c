/*
 * (C) COPYRIGHT 2021 Arm Limited or its affiliates
 * ALL RIGHTS RESERVED
 *
 * This file was AUTOGENERATED from the RMM specification.
 * RMM specification source version: e9d4d747
 */

#include "tb.h"
#include "tb_rmi_realm_create.h"

bool tb_rmi_realm_create(
    uint64_t rd,
    uint64_t params_ptr)
{
    // Initialize registers
    struct tb_regs __tb_regs = __tb_arb_regs();
    __tb_regs.X0 = SMC_RMM_REALM_CREATE;
    __tb_regs.X1 = (uint64_t)rd;
    __tb_regs.X2 = (uint64_t)params_ptr;

    // Initialize global state
    __init_global_state(__tb_regs.X0);

    // Declare context variables
    struct rmi_realm_params_buffer params;

    // Assign context variables before command execution
    params = RealmParams(params_ptr);

    // Pre-conditions
    bool failure_params_align_pre = !AddrIsGranuleAligned(params_ptr);
    bool failure_params_bound_pre = !PaIsDelegable(params_ptr);
    bool failure_params_pas_pre = Granule(params_ptr).pas != NS;
    bool failure_params_valid_pre = !RmiRealmParamsIsValid(params_ptr);
    bool failure_params_supp_pre = !RealmParamsSupported(params);
    bool failure_alias_pre = AddrInRange(rd, params.rtt_base, (params.rtt_num_start - 1) * RMM_GRANULE_SIZE);
    bool failure_rd_align_pre = !AddrIsGranuleAligned(rd);
    bool failure_rd_bound_pre = !PaIsDelegable(rd);
    bool failure_rd_state_pre = Granule(rd).state != DELEGATED;
    bool failure_rtt_align_pre = !AddrIsAligned(params.rtt_base, params.rtt_num_start * RMM_GRANULE_SIZE);
    bool failure_rtt_num_level_pre = !RttConfigIsValid(params.s2sz, params.rtt_level_start, params.rtt_num_start);
    bool failure_rtt_state_pre = !RttsStateEqual(params.rtt_base, params.rtt_num_start, DELEGATED);
    bool failure_vmid_valid_pre = !VmidIsValid(params.vmid) || !VmidIsFree(params.vmid);
    bool no_failures_pre = !failure_params_align_pre
        && !failure_params_bound_pre
        && !failure_params_pas_pre
        && !failure_params_valid_pre
        && !failure_params_supp_pre
        && !failure_alias_pre
        && !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_rtt_align_pre
        && !failure_rtt_num_level_pre
        && !failure_rtt_state_pre
        && !failure_vmid_valid_pre;

    // Execute command
    uint64_t result = tb_handle_smc(&__tb_regs);

    // Assign context variables after command execution
    params = RealmParams(params_ptr);

    // Post-conditions
    bool failure_params_align_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_params_bound_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_params_pas_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_params_valid_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_params_supp_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_alias_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rd_align_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rd_bound_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rd_state_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rtt_align_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rtt_num_level_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rtt_state_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_vmid_valid_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool success_rd_state_post = Granule(rd).state == RD;
    bool success_realm_state_post = Realm(rd).state == NEW;
    bool success_rec_index_post = Realm(rd).rec_index == 0;
    bool success_rtt_base_post = Realm(rd).rtt_base == params.rtt_base;
    bool success_rtt_state_post = RttsStateEqual(Realm(rd).rtt_base, Realm(rd).rtt_num_start, RTT);
    bool success_rtte_p_states_post = RttsAllProtectedEntriesState(Realm(rd).rtt_base, Realm(rd).rtt_num_start, UNASSIGNED);
    bool success_rtte_up_states_post = RttsAllUnprotectedEntriesState(Realm(rd).rtt_base, Realm(rd).rtt_num_start, UNASSIGNED_NS);
    bool success_rtte_ripas_post = RttsAllProtectedEntriesRipas(Realm(rd).rtt_base, Realm(rd).rtt_num_start, EMPTY);
    bool success_ipa_width_post = Realm(rd).ipa_width == params.s2sz;
    bool success_hash_algo_post = Equal(Realm(rd).hash_algo, params.hash_algo);
    bool success_rim_post = Realm(rd).measurements[0] == RimInit(Realm(rd).hash_algo, params);
    bool success_rem_post = (Realm(rd).measurements[1] == Zeros() && Realm(rd).measurements[2] == Zeros() && Realm(rd).measurements[3] == Zeros() && Realm(rd).measurements[4] == Zeros());
    bool success_rtt_level_post = Realm(rd).rtt_level_start == params.rtt_level_start;
    bool success_rtt_num_post = Realm(rd).rtt_num_start == params.rtt_num_start;
    bool success_vmid_post = Realm(rd).vmid == params.vmid;
    bool success_rpv_post = Realm(rd).rpv == params.rpv;

    /*// Failure condition assertions*/
    /*bool prop_failure_params_align_ante = failure_params_align_pre;*/
    /*__COVER(prop_failure_params_align_ante);*/
    /*if (prop_failure_params_align_ante) {*/
        /*bool prop_failure_params_align_cons = failure_params_align_post;*/
        /*__COVER(prop_failure_params_align_cons);*/
        /*__ASSERT(prop_failure_params_align_cons, "prop_failure_params_align_cons");*/
    /*}*/

    /*bool prop_failure_params_bound_ante = !failure_params_align_pre*/
        /*&& failure_params_bound_pre;*/
    /*__COVER(prop_failure_params_bound_ante);*/
    /*if (prop_failure_params_bound_ante) {*/
        /*bool prop_failure_params_bound_cons = failure_params_bound_post;*/
        /*__COVER(prop_failure_params_bound_cons);*/
        /*__ASSERT(prop_failure_params_bound_cons, "prop_failure_params_bound_cons");*/
    /*}*/

    /*bool prop_failure_params_pas_ante = !failure_params_align_pre*/
        /*&& !failure_params_bound_pre*/
        /*&& failure_params_pas_pre;*/
    /*__COVER(prop_failure_params_pas_ante);*/
    /*if (prop_failure_params_pas_ante) {*/
        /*bool prop_failure_params_pas_cons = failure_params_pas_post;*/
        /*__COVER(prop_failure_params_pas_cons);*/
        /*__ASSERT(prop_failure_params_pas_cons, "prop_failure_params_pas_cons");*/
    /*}*/

    /*bool prop_failure_params_valid_ante = !failure_params_align_pre*/
        /*&& !failure_params_bound_pre*/
        /*&& !failure_params_pas_pre*/
        /*&& failure_params_valid_pre;*/
    /*__COVER(prop_failure_params_valid_ante);*/
    /*if (prop_failure_params_valid_ante) {*/
        /*bool prop_failure_params_valid_cons = failure_params_valid_post;*/
        /*__COVER(prop_failure_params_valid_cons);*/
        /*__ASSERT(prop_failure_params_valid_cons, "prop_failure_params_valid_cons");*/
    /*}*/

    /*bool prop_failure_params_supp_ante = !failure_params_align_pre*/
        /*&& !failure_params_bound_pre*/
        /*&& !failure_params_pas_pre*/
        /*&& !failure_params_valid_pre*/
        /*&& failure_params_supp_pre;*/
    /*__COVER(prop_failure_params_supp_ante);*/
    /*if (prop_failure_params_supp_ante) {*/
        /*bool prop_failure_params_supp_cons = failure_params_supp_post;*/
        /*__COVER(prop_failure_params_supp_cons);*/
        /*__ASSERT(prop_failure_params_supp_cons, "prop_failure_params_supp_cons");*/
    /*}*/

    /*bool prop_failure_alias_ante = !failure_params_align_pre*/
        /*&& !failure_params_bound_pre*/
        /*&& !failure_params_pas_pre*/
        /*&& !failure_params_valid_pre*/
        /*&& !failure_params_supp_pre*/
        /*&& failure_alias_pre;*/
    /*__COVER(prop_failure_alias_ante);*/
    /*if (prop_failure_alias_ante) {*/
        /*bool prop_failure_alias_cons = failure_alias_post;*/
        /*__COVER(prop_failure_alias_cons);*/
        /*__ASSERT(prop_failure_alias_cons, "prop_failure_alias_cons");*/
    /*}*/

    /*bool prop_failure_rd_align_ante = !failure_params_align_pre*/
        /*&& !failure_params_bound_pre*/
        /*&& !failure_params_pas_pre*/
        /*&& !failure_params_valid_pre*/
        /*&& !failure_params_supp_pre*/
        /*&& !failure_alias_pre*/
        /*&& failure_rd_align_pre;*/
    /*__COVER(prop_failure_rd_align_ante);*/
    /*if (prop_failure_rd_align_ante) {*/
        /*bool prop_failure_rd_align_cons = failure_rd_align_post;*/
        /*__COVER(prop_failure_rd_align_cons);*/
        /*__ASSERT(prop_failure_rd_align_cons, "prop_failure_rd_align_cons");*/
    /*}*/

    /*bool prop_failure_rd_bound_ante = !failure_params_align_pre*/
        /*&& !failure_params_bound_pre*/
        /*&& !failure_params_pas_pre*/
        /*&& !failure_params_valid_pre*/
        /*&& !failure_params_supp_pre*/
        /*&& !failure_alias_pre*/
        /*&& !failure_rd_align_pre*/
        /*&& failure_rd_bound_pre;*/
    /*__COVER(prop_failure_rd_bound_ante);*/
    /*if (prop_failure_rd_bound_ante) {*/
        /*bool prop_failure_rd_bound_cons = failure_rd_bound_post;*/
        /*__COVER(prop_failure_rd_bound_cons);*/
        /*__ASSERT(prop_failure_rd_bound_cons, "prop_failure_rd_bound_cons");*/
    /*}*/

    /*bool prop_failure_rd_state_ante = !failure_params_align_pre*/
        /*&& !failure_params_bound_pre*/
        /*&& !failure_params_pas_pre*/
        /*&& !failure_params_valid_pre*/
        /*&& !failure_params_supp_pre*/
        /*&& !failure_alias_pre*/
        /*&& !failure_rd_align_pre*/
        /*&& !failure_rd_bound_pre*/
        /*&& failure_rd_state_pre;*/
    /*__COVER(prop_failure_rd_state_ante);*/
    /*if (prop_failure_rd_state_ante) {*/
        /*bool prop_failure_rd_state_cons = failure_rd_state_post;*/
        /*__COVER(prop_failure_rd_state_cons);*/
        /*__ASSERT(prop_failure_rd_state_cons, "prop_failure_rd_state_cons");*/
    /*}*/

    /*bool prop_failure_rtt_align_ante = !failure_params_align_pre*/
        /*&& !failure_params_bound_pre*/
        /*&& !failure_params_pas_pre*/
        /*&& !failure_params_valid_pre*/
        /*&& !failure_params_supp_pre*/
        /*&& !failure_alias_pre*/
        /*&& !failure_rd_align_pre*/
        /*&& !failure_rd_bound_pre*/
        /*&& !failure_rd_state_pre*/
        /*&& failure_rtt_align_pre;*/
    /*__COVER(prop_failure_rtt_align_ante);*/
    /*if (prop_failure_rtt_align_ante) {*/
        /*bool prop_failure_rtt_align_cons = failure_rtt_align_post;*/
        /*__COVER(prop_failure_rtt_align_cons);*/
        /*__ASSERT(prop_failure_rtt_align_cons, "prop_failure_rtt_align_cons");*/
    /*}*/

    /*bool prop_failure_rtt_num_level_ante = !failure_params_align_pre*/
        /*&& !failure_params_bound_pre*/
        /*&& !failure_params_pas_pre*/
        /*&& !failure_params_valid_pre*/
        /*&& !failure_params_supp_pre*/
        /*&& !failure_alias_pre*/
        /*&& !failure_rd_align_pre*/
        /*&& !failure_rd_bound_pre*/
        /*&& !failure_rd_state_pre*/
        /*&& !failure_rtt_align_pre*/
        /*&& failure_rtt_num_level_pre;*/
    /*__COVER(prop_failure_rtt_num_level_ante);*/
    /*if (prop_failure_rtt_num_level_ante) {*/
        /*bool prop_failure_rtt_num_level_cons = failure_rtt_num_level_post;*/
        /*__COVER(prop_failure_rtt_num_level_cons);*/
        /*__ASSERT(prop_failure_rtt_num_level_cons, "prop_failure_rtt_num_level_cons");*/
    /*}*/

    /*bool prop_failure_rtt_state_ante = !failure_params_align_pre*/
        /*&& !failure_params_bound_pre*/
        /*&& !failure_params_pas_pre*/
        /*&& !failure_params_valid_pre*/
        /*&& !failure_params_supp_pre*/
        /*&& !failure_alias_pre*/
        /*&& !failure_rd_align_pre*/
        /*&& !failure_rd_bound_pre*/
        /*&& !failure_rd_state_pre*/
        /*&& !failure_rtt_align_pre*/
        /*&& !failure_rtt_num_level_pre*/
        /*&& failure_rtt_state_pre;*/
    /*__COVER(prop_failure_rtt_state_ante);*/
    /*if (prop_failure_rtt_state_ante) {*/
        /*bool prop_failure_rtt_state_cons = failure_rtt_state_post;*/
        /*__COVER(prop_failure_rtt_state_cons);*/
        /*__ASSERT(prop_failure_rtt_state_cons, "prop_failure_rtt_state_cons");*/
    /*}*/

    /*bool prop_failure_vmid_valid_ante = !failure_params_align_pre*/
        /*&& !failure_params_bound_pre*/
        /*&& !failure_params_pas_pre*/
        /*&& !failure_params_valid_pre*/
        /*&& !failure_params_supp_pre*/
        /*&& !failure_alias_pre*/
        /*&& !failure_rd_align_pre*/
        /*&& !failure_rd_bound_pre*/
        /*&& !failure_rd_state_pre*/
        /*&& !failure_rtt_align_pre*/
        /*&& !failure_rtt_num_level_pre*/
        /*&& !failure_rtt_state_pre*/
        /*&& failure_vmid_valid_pre;*/
    /*__COVER(prop_failure_vmid_valid_ante);*/
    /*if (prop_failure_vmid_valid_ante) {*/
        /*bool prop_failure_vmid_valid_cons = failure_vmid_valid_post;*/
        /*__COVER(prop_failure_vmid_valid_cons);*/
        /*__ASSERT(prop_failure_vmid_valid_cons, "prop_failure_vmid_valid_cons");*/
    /*}*/

    /*// Result assertion*/
    /*bool prop_result_ante = no_failures_pre;*/
    /*__COVER(prop_result_ante);*/
    /*if (prop_result_ante) {*/
        /*bool prop_result_cons = result == RMI_SUCCESS;*/
        /*__COVER(prop_result_cons);*/
        /*__ASSERT(prop_result_cons, "prop_result_cons");*/
    /*}*/

    /*// Success condition assertions*/
    /*bool prop_success_rd_state_ante = no_failures_pre;*/
    /*__COVER(prop_success_rd_state_ante);*/
    /*if (prop_success_rd_state_ante) {*/
        /*bool prop_success_rd_state_cons = success_rd_state_post;*/
        /*__COVER(prop_success_rd_state_cons);*/
        /*__ASSERT(prop_success_rd_state_cons, "prop_success_rd_state_cons");*/
    /*}*/

    /*bool prop_success_realm_state_ante = no_failures_pre;*/
    /*__COVER(prop_success_realm_state_ante);*/
    /*if (prop_success_realm_state_ante) {*/
        /*bool prop_success_realm_state_cons = success_realm_state_post;*/
        /*__COVER(prop_success_realm_state_cons);*/
        /*__ASSERT(prop_success_realm_state_cons, "prop_success_realm_state_cons");*/
    /*}*/

    /*bool prop_success_rec_index_ante = no_failures_pre;*/
    /*__COVER(prop_success_rec_index_ante);*/
    /*if (prop_success_rec_index_ante) {*/
        /*bool prop_success_rec_index_cons = success_rec_index_post;*/
        /*__COVER(prop_success_rec_index_cons);*/
        /*__ASSERT(prop_success_rec_index_cons, "prop_success_rec_index_cons");*/
    /*}*/

    /*bool prop_success_rtt_base_ante = no_failures_pre;*/
    /*__COVER(prop_success_rtt_base_ante);*/
    /*if (prop_success_rtt_base_ante) {*/
        /*bool prop_success_rtt_base_cons = success_rtt_base_post;*/
        /*__COVER(prop_success_rtt_base_cons);*/
        /*__ASSERT(prop_success_rtt_base_cons, "prop_success_rtt_base_cons");*/
    /*}*/

    /*bool prop_success_rtt_state_ante = no_failures_pre;*/
    /*__COVER(prop_success_rtt_state_ante);*/
    /*if (prop_success_rtt_state_ante) {*/
        /*bool prop_success_rtt_state_cons = success_rtt_state_post;*/
        /*__COVER(prop_success_rtt_state_cons);*/
        /*__ASSERT(prop_success_rtt_state_cons, "prop_success_rtt_state_cons");*/
    /*}*/

    /*bool prop_success_rtte_p_states_ante = no_failures_pre;*/
    /*__COVER(prop_success_rtte_p_states_ante);*/
    /*if (prop_success_rtte_p_states_ante) {*/
        /*bool prop_success_rtte_p_states_cons = success_rtte_p_states_post;*/
        /*__COVER(prop_success_rtte_p_states_cons);*/
        /*__ASSERT(prop_success_rtte_p_states_cons, "prop_success_rtte_p_states_cons");*/
    /*}*/

    /*bool prop_success_rtte_up_states_ante = no_failures_pre;*/
    /*__COVER(prop_success_rtte_up_states_ante);*/
    /*if (prop_success_rtte_up_states_ante) {*/
        /*bool prop_success_rtte_up_states_cons = success_rtte_up_states_post;*/
        /*__COVER(prop_success_rtte_up_states_cons);*/
        /*__ASSERT(prop_success_rtte_up_states_cons, "prop_success_rtte_up_states_cons");*/
    /*}*/

    /*bool prop_success_rtte_ripas_ante = no_failures_pre;*/
    /*__COVER(prop_success_rtte_ripas_ante);*/
    /*if (prop_success_rtte_ripas_ante) {*/
        /*bool prop_success_rtte_ripas_cons = success_rtte_ripas_post;*/
        /*__COVER(prop_success_rtte_ripas_cons);*/
        /*__ASSERT(prop_success_rtte_ripas_cons, "prop_success_rtte_ripas_cons");*/
    /*}*/

    /*bool prop_success_ipa_width_ante = no_failures_pre;*/
    /*__COVER(prop_success_ipa_width_ante);*/
    /*if (prop_success_ipa_width_ante) {*/
        /*bool prop_success_ipa_width_cons = success_ipa_width_post;*/
        /*__COVER(prop_success_ipa_width_cons);*/
        /*__ASSERT(prop_success_ipa_width_cons, "prop_success_ipa_width_cons");*/
    /*}*/

    /*bool prop_success_hash_algo_ante = no_failures_pre;*/
    /*__COVER(prop_success_hash_algo_ante);*/
    /*if (prop_success_hash_algo_ante) {*/
        /*bool prop_success_hash_algo_cons = success_hash_algo_post;*/
        /*__COVER(prop_success_hash_algo_cons);*/
        /*__ASSERT(prop_success_hash_algo_cons, "prop_success_hash_algo_cons");*/
    /*}*/

    /*bool prop_success_rim_ante = no_failures_pre;*/
    /*__COVER(prop_success_rim_ante);*/
    /*if (prop_success_rim_ante) {*/
        /*bool prop_success_rim_cons = success_rim_post;*/
        /*__COVER(prop_success_rim_cons);*/
        /*__ASSERT(prop_success_rim_cons, "prop_success_rim_cons");*/
    /*}*/

    /*bool prop_success_rem_ante = no_failures_pre;*/
    /*__COVER(prop_success_rem_ante);*/
    /*if (prop_success_rem_ante) {*/
        /*bool prop_success_rem_cons = success_rem_post;*/
        /*__COVER(prop_success_rem_cons);*/
        /*__ASSERT(prop_success_rem_cons, "prop_success_rem_cons");*/
    /*}*/

    /*bool prop_success_rtt_level_ante = no_failures_pre;*/
    /*__COVER(prop_success_rtt_level_ante);*/
    /*if (prop_success_rtt_level_ante) {*/
        /*bool prop_success_rtt_level_cons = success_rtt_level_post;*/
        /*__COVER(prop_success_rtt_level_cons);*/
        /*__ASSERT(prop_success_rtt_level_cons, "prop_success_rtt_level_cons");*/
    /*}*/

    /*bool prop_success_rtt_num_ante = no_failures_pre;*/
    /*__COVER(prop_success_rtt_num_ante);*/
    /*if (prop_success_rtt_num_ante) {*/
        /*bool prop_success_rtt_num_cons = success_rtt_num_post;*/
        /*__COVER(prop_success_rtt_num_cons);*/
        /*__ASSERT(prop_success_rtt_num_cons, "prop_success_rtt_num_cons");*/
    /*}*/

    /*bool prop_success_vmid_ante = no_failures_pre;*/
    /*__COVER(prop_success_vmid_ante);*/
    /*if (prop_success_vmid_ante) {*/
        /*bool prop_success_vmid_cons = success_vmid_post;*/
        /*__COVER(prop_success_vmid_cons);*/
        /*__ASSERT(prop_success_vmid_cons, "prop_success_vmid_cons");*/
    /*}*/

    /*bool prop_success_rpv_ante = no_failures_pre;*/
    /*__COVER(prop_success_rpv_ante);*/
    /*if (prop_success_rpv_ante) {*/
        /*bool prop_success_rpv_cons = success_rpv_post;*/
        /*__COVER(prop_success_rpv_cons);*/
        /*__ASSERT(prop_success_rpv_cons, "prop_success_rpv_cons");*/
    /*}*/

    /*// Assertion used to check consistency of the testbench*/
    /*__tb_expect_fail();*/

    /*return no_failures_pre;*/
    return true;
}

void entry_point(
    void)
{
    tb_rmi_realm_create(nondet_uint64_t(), nondet_uint64_t());
}

