/*
 * (C) COPYRIGHT 2021 Arm Limited or its affiliates
 * ALL RIGHTS RESERVED
 *
 * This file was AUTOGENERATED from the RMM specification.
 * RMM specification source version: e9d4d747
 */

#include "tb.h"
#include "tb_rmi_rtt_set_ripas.h"

bool tb_rmi_rtt_set_ripas(
    uint64_t rd,
    uint64_t rec,
    uint64_t ipa,
    int64_t level,
    enum rmi_ripas ripas)
{
    // Initialize registers
    struct tb_regs __tb_regs = __tb_arb_regs();
    __tb_regs.X0 = SMC_RMM_RTT_SET_RIPAS;
    __tb_regs.X1 = (uint64_t)rd;
    __tb_regs.X2 = (uint64_t)rec;
    __tb_regs.X3 = (uint64_t)ipa;
    __tb_regs.X4 = (uint64_t)level;
    __tb_regs.X5 = (uint64_t)ripas;

    // Initialize global state
    __init_global_state(__tb_regs.X0);

    // Declare context variables
    struct rmm_rtt_walk_result walk;
    uint64_t entry_idx;
    uint64_t ripas_addr;

    // Assign context variables before command execution
    walk = RttWalk(
        rd, ipa, level);
    entry_idx = RttEntryIndex(
        ipa, walk.level);
    ripas_addr = Rec(rec).ripas_addr;

    // Pre-conditions
    bool failure_rd_align_pre = !AddrIsGranuleAligned(rd);
    bool failure_rd_bound_pre = !PaIsDelegable(rd);
    bool failure_rd_state_pre = Granule(rd).state != RD;
    bool failure_level_bound_pre = !RttLevelIsValid(rd, level);
    bool failure_rec_align_pre = !AddrIsGranuleAligned(rec);
    bool failure_rec_bound_pre = !PaIsDelegable(rec);
    bool failure_rec_gran_state_pre = Granule(rec).state != REC;
    bool failure_rec_state_pre = Rec(rec).state == RUNNING;
    bool failure_rec_owner_pre = Rec(rec).owner != rd;
    bool failure_ipa_align_pre = !AddrIsRttLevelAligned(ipa, level);
    bool failure_ripas_valid_pre = !RmiRipasIsValid(Slice(X5, 31, 0));
    bool failure_target_addr_pre = ipa != Rec(rec).ripas_addr;
    bool failure_target_bound_pre = ((UInt(ipa) + RttLevelSize(level)) > UInt(Rec(rec).ripas_top));
    bool failure_target_ripas_pre = !Equal(ripas, Rec(rec).ripas_value);
    bool failure_rtt_walk_pre = walk.level < level;
    bool failure_rtte_state_pre = (walk.entry.state != UNASSIGNED && walk.entry.state != ASSIGNED);
    bool no_failures_pre = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && !failure_rec_align_pre
        && !failure_rec_bound_pre
        && !failure_rec_gran_state_pre
        && !failure_rec_state_pre
        && !failure_rec_owner_pre
        && !failure_ipa_align_pre
        && !failure_ripas_valid_pre
        && !failure_target_addr_pre
        && !failure_target_bound_pre
        && !failure_target_ripas_pre
        && !failure_rtt_walk_pre
        && !failure_rtte_state_pre;

    // Execute command
    uint64_t result = tb_handle_smc(&__tb_regs);

    // Assign context variables after command execution
    walk = RttWalk(
        rd, ipa, level);
    entry_idx = RttEntryIndex(
        ipa, walk.level);

    // Post-conditions
    bool failure_rd_align_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rd_bound_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rd_state_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_level_bound_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rec_align_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rec_bound_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rec_gran_state_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rec_state_post = ResultEqual_2(result, RMI_ERROR_REC);
    bool failure_rec_owner_post = ResultEqual_2(result, RMI_ERROR_REC);
    bool failure_ipa_align_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_ripas_valid_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_target_addr_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_target_bound_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_target_ripas_post = ResultEqual_2(result, RMI_ERROR_INPUT);
    bool failure_rtt_walk_post = ResultEqual_3(result, RMI_ERROR_RTT, walk.level);
    bool failure_rtte_state_post = ResultEqual_3(result, RMI_ERROR_RTT, walk.level);
    bool success_rtte_ripas_post = Equal(walk.entry.ripas, ripas);
    bool success_ripas_addr_post = Rec(rec).ripas_addr == ToAddress(UInt(ripas_addr) + RttLevelSize(level));

    // Failure condition assertions
    bool prop_failure_rd_align_ante = failure_rd_align_pre;
    __COVER(prop_failure_rd_align_ante);
    if (prop_failure_rd_align_ante) {
        bool prop_failure_rd_align_cons = failure_rd_align_post;
        __COVER(prop_failure_rd_align_cons);
        __ASSERT(prop_failure_rd_align_cons, "prop_failure_rd_align_cons");
    }

    bool prop_failure_rd_bound_ante = !failure_rd_align_pre
        && failure_rd_bound_pre;
    __COVER(prop_failure_rd_bound_ante);
    if (prop_failure_rd_bound_ante) {
        bool prop_failure_rd_bound_cons = failure_rd_bound_post;
        __COVER(prop_failure_rd_bound_cons);
        __ASSERT(prop_failure_rd_bound_cons, "prop_failure_rd_bound_cons");
    }

    bool prop_failure_rd_state_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && failure_rd_state_pre;
    __COVER(prop_failure_rd_state_ante);
    if (prop_failure_rd_state_ante) {
        bool prop_failure_rd_state_cons = failure_rd_state_post;
        __COVER(prop_failure_rd_state_cons);
        __ASSERT(prop_failure_rd_state_cons, "prop_failure_rd_state_cons");
    }

    bool prop_failure_level_bound_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && failure_level_bound_pre;
    __COVER(prop_failure_level_bound_ante);
    if (prop_failure_level_bound_ante) {
        bool prop_failure_level_bound_cons = failure_level_bound_post;
        __COVER(prop_failure_level_bound_cons);
        __ASSERT(prop_failure_level_bound_cons, "prop_failure_level_bound_cons");
    }

    bool prop_failure_rec_align_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && failure_rec_align_pre;
    __COVER(prop_failure_rec_align_ante);
    if (prop_failure_rec_align_ante) {
        bool prop_failure_rec_align_cons = failure_rec_align_post;
        __COVER(prop_failure_rec_align_cons);
        __ASSERT(prop_failure_rec_align_cons, "prop_failure_rec_align_cons");
    }

    bool prop_failure_rec_bound_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && !failure_rec_align_pre
        && failure_rec_bound_pre;
    __COVER(prop_failure_rec_bound_ante);
    if (prop_failure_rec_bound_ante) {
        bool prop_failure_rec_bound_cons = failure_rec_bound_post;
        __COVER(prop_failure_rec_bound_cons);
        __ASSERT(prop_failure_rec_bound_cons, "prop_failure_rec_bound_cons");
    }

    bool prop_failure_rec_gran_state_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && !failure_rec_align_pre
        && !failure_rec_bound_pre
        && failure_rec_gran_state_pre;
    __COVER(prop_failure_rec_gran_state_ante);
    if (prop_failure_rec_gran_state_ante) {
        bool prop_failure_rec_gran_state_cons = failure_rec_gran_state_post;
        __COVER(prop_failure_rec_gran_state_cons);
        __ASSERT(prop_failure_rec_gran_state_cons, "prop_failure_rec_gran_state_cons");
    }

    bool prop_failure_rec_state_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && !failure_rec_align_pre
        && !failure_rec_bound_pre
        && !failure_rec_gran_state_pre
        && failure_rec_state_pre;
    __COVER(prop_failure_rec_state_ante);
    if (prop_failure_rec_state_ante) {
        bool prop_failure_rec_state_cons = failure_rec_state_post;
        __COVER(prop_failure_rec_state_cons);
        __ASSERT(prop_failure_rec_state_cons, "prop_failure_rec_state_cons");
    }

    bool prop_failure_rec_owner_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && !failure_rec_align_pre
        && !failure_rec_bound_pre
        && !failure_rec_gran_state_pre
        && !failure_rec_state_pre
        && failure_rec_owner_pre;
    __COVER(prop_failure_rec_owner_ante);
    if (prop_failure_rec_owner_ante) {
        bool prop_failure_rec_owner_cons = failure_rec_owner_post;
        __COVER(prop_failure_rec_owner_cons);
        __ASSERT(prop_failure_rec_owner_cons, "prop_failure_rec_owner_cons");
    }

    bool prop_failure_ipa_align_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && !failure_rec_align_pre
        && !failure_rec_bound_pre
        && !failure_rec_gran_state_pre
        && !failure_rec_state_pre
        && !failure_rec_owner_pre
        && failure_ipa_align_pre;
    __COVER(prop_failure_ipa_align_ante);
    if (prop_failure_ipa_align_ante) {
        bool prop_failure_ipa_align_cons = failure_ipa_align_post;
        __COVER(prop_failure_ipa_align_cons);
        __ASSERT(prop_failure_ipa_align_cons, "prop_failure_ipa_align_cons");
    }

    bool prop_failure_ripas_valid_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && !failure_rec_align_pre
        && !failure_rec_bound_pre
        && !failure_rec_gran_state_pre
        && !failure_rec_state_pre
        && !failure_rec_owner_pre
        && !failure_ipa_align_pre
        && failure_ripas_valid_pre;
    __COVER(prop_failure_ripas_valid_ante);
    if (prop_failure_ripas_valid_ante) {
        bool prop_failure_ripas_valid_cons = failure_ripas_valid_post;
        __COVER(prop_failure_ripas_valid_cons);
        __ASSERT(prop_failure_ripas_valid_cons, "prop_failure_ripas_valid_cons");
    }

    bool prop_failure_target_addr_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && !failure_rec_align_pre
        && !failure_rec_bound_pre
        && !failure_rec_gran_state_pre
        && !failure_rec_state_pre
        && !failure_rec_owner_pre
        && !failure_ipa_align_pre
        && !failure_ripas_valid_pre
        && failure_target_addr_pre;
    __COVER(prop_failure_target_addr_ante);
    if (prop_failure_target_addr_ante) {
        bool prop_failure_target_addr_cons = failure_target_addr_post;
        __COVER(prop_failure_target_addr_cons);
        __ASSERT(prop_failure_target_addr_cons, "prop_failure_target_addr_cons");
    }

    bool prop_failure_target_bound_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && !failure_rec_align_pre
        && !failure_rec_bound_pre
        && !failure_rec_gran_state_pre
        && !failure_rec_state_pre
        && !failure_rec_owner_pre
        && !failure_ipa_align_pre
        && !failure_ripas_valid_pre
        && !failure_target_addr_pre
        && failure_target_bound_pre;
    __COVER(prop_failure_target_bound_ante);
    if (prop_failure_target_bound_ante) {
        bool prop_failure_target_bound_cons = failure_target_bound_post;
        __COVER(prop_failure_target_bound_cons);
        __ASSERT(prop_failure_target_bound_cons, "prop_failure_target_bound_cons");
    }

    bool prop_failure_target_ripas_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && !failure_rec_align_pre
        && !failure_rec_bound_pre
        && !failure_rec_gran_state_pre
        && !failure_rec_state_pre
        && !failure_rec_owner_pre
        && !failure_ipa_align_pre
        && !failure_ripas_valid_pre
        && !failure_target_addr_pre
        && !failure_target_bound_pre
        && failure_target_ripas_pre;
    __COVER(prop_failure_target_ripas_ante);
    if (prop_failure_target_ripas_ante) {
        bool prop_failure_target_ripas_cons = failure_target_ripas_post;
        __COVER(prop_failure_target_ripas_cons);
        __ASSERT(prop_failure_target_ripas_cons, "prop_failure_target_ripas_cons");
    }

    bool prop_failure_rtt_walk_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && !failure_rec_align_pre
        && !failure_rec_bound_pre
        && !failure_rec_gran_state_pre
        && !failure_rec_state_pre
        && !failure_rec_owner_pre
        && !failure_ipa_align_pre
        && !failure_ripas_valid_pre
        && !failure_target_addr_pre
        && !failure_target_bound_pre
        && !failure_target_ripas_pre
        && failure_rtt_walk_pre;
    __COVER(prop_failure_rtt_walk_ante);
    if (prop_failure_rtt_walk_ante) {
        bool prop_failure_rtt_walk_cons = failure_rtt_walk_post;
        __COVER(prop_failure_rtt_walk_cons);
        __ASSERT(prop_failure_rtt_walk_cons, "prop_failure_rtt_walk_cons");
    }

    bool prop_failure_rtte_state_ante = !failure_rd_align_pre
        && !failure_rd_bound_pre
        && !failure_rd_state_pre
        && !failure_level_bound_pre
        && !failure_rec_align_pre
        && !failure_rec_bound_pre
        && !failure_rec_gran_state_pre
        && !failure_rec_state_pre
        && !failure_rec_owner_pre
        && !failure_ipa_align_pre
        && !failure_ripas_valid_pre
        && !failure_target_addr_pre
        && !failure_target_bound_pre
        && !failure_target_ripas_pre
        && !failure_rtt_walk_pre
        && failure_rtte_state_pre;
    __COVER(prop_failure_rtte_state_ante);
    if (prop_failure_rtte_state_ante) {
        bool prop_failure_rtte_state_cons = failure_rtte_state_post;
        __COVER(prop_failure_rtte_state_cons);
        __ASSERT(prop_failure_rtte_state_cons, "prop_failure_rtte_state_cons");
    }

    // Result assertion
    bool prop_result_ante = no_failures_pre;
    __COVER(prop_result_ante);
    if (prop_result_ante) {
        bool prop_result_cons = result == RMI_SUCCESS;
        __COVER(prop_result_cons);
        __ASSERT(prop_result_cons, "prop_result_cons");
    }

    // Success condition assertions
    bool prop_success_rtte_ripas_ante = no_failures_pre;
    __COVER(prop_success_rtte_ripas_ante);
    if (prop_success_rtte_ripas_ante) {
        bool prop_success_rtte_ripas_cons = success_rtte_ripas_post;
        __COVER(prop_success_rtte_ripas_cons);
        __ASSERT(prop_success_rtte_ripas_cons, "prop_success_rtte_ripas_cons");
    }

    bool prop_success_ripas_addr_ante = no_failures_pre;
    __COVER(prop_success_ripas_addr_ante);
    if (prop_success_ripas_addr_ante) {
        bool prop_success_ripas_addr_cons = success_ripas_addr_post;
        __COVER(prop_success_ripas_addr_cons);
        __ASSERT(prop_success_ripas_addr_cons, "prop_success_ripas_addr_cons");
    }

    // Assertion used to check consistency of the testbench
    __tb_expect_fail();

    return no_failures_pre;
}

void entry_point(
    void)
{
    tb_rmi_rtt_set_ripas(nondet_uint64_t(), nondet_uint64_t(), nondet_uint64_t(), nondet_int64_t(), nondet_enum rmi_ripas());
}

